<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Car Management</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f9;
            color: #333;
        }

        h1 {
            text-align: center;
            color: #444;
            margin-top: 20px;
        }

        table {
            width: 90%;
            margin: 20px auto;
            border-collapse: collapse;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            background-color: #fff;
        }

        table th, table td {
            padding: 10px;
            text-align: center;
            border: 1px solid #ddd;
        }

        table th {
            background-color: #007BFF;
            color: white;
            text-transform: uppercase;
        }

        table tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        table tr:hover {
            background-color: #f1f1f1;
        }

        form {
            max-width: 600px;
            margin: 20px auto;
            padding: 20px;
            background: #fff;
            border: 1px solid #ddd;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        form label {
            display: block;
            margin: 10px 0 5px;
            font-weight: bold;
        }

        form input, form button {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        form button {
            background-color: #007BFF;
            color: white;
            font-size: 16px;
            border: none;
            cursor: pointer;
        }

        form button:hover {
            background-color: #0056b3;
        }

        .container {
            margin: 0 auto;
            max-width: 1200px;
        }

        .section {
            margin-bottom: 40px;
        }
    </style>
</head>
	<body onload='showAll();'>
		<script>
		
			function showAll() {
				var settings = {
					"url": "http://localhost:8080/home/dealerships/allCars",
					"method": "GET",
					"timeout": 0,
					"processData": false,
					"mimeType": "multipart/form-data",
					"contentType": false
				};
				$.ajax(settings).done(function (response) {
					updateTable(response);
				});
			}

			function updateTable(json) {
				const result = jQuery.parseJSON(json);
				const table = document.getElementById("resultsTable");

				// Clear existing rows
				const rowCount = table.rows.length;
				for (let i = rowCount - 1; i > 0; i--) {
					table.deleteRow(i);
				}

				// Populate the table
				result.forEach(car => {
					const row = table.insertRow(-1);
					row.insertCell(0).innerHTML = car.brand;
					row.insertCell(1).innerHTML = car.model;
					row.insertCell(2).innerHTML = car.fuel;
					row.insertCell(3).innerHTML = car.engine;
					row.insertCell(4).innerHTML = car.info;
					row.insertCell(5).innerHTML = car.seats;
					row.insertCell(6).innerHTML = car.price;
					row.insertCell(7).innerHTML = car.numOfCars;
				});
			}
			 
			function updateSearchResults(cars) {
			const tableBody = document.querySelector("#searchResultsTable tbody");

			// Clear all existing rows in the table body
			tableBody.innerHTML = "";

			// Add rows for each car in the response
			cars.forEach(car => {
				const row = document.createElement("tr");

				row.innerHTML = `
					<td>${car.brand}</td>
					<td>${car.model}</td>
					<td>${car.fuel}</td>
					<td>${car.engine}</td>
					<td>${car.info}</td>
					<td>${car.seats}</td>
					<td>${car.price}</td>
					<td>${car.numOfCars}</td>
				`;

				tableBody.appendChild(row);
			});
		}
			
			
			function addCar() {
				const params = {
					id: document.getElementById("id").value,
					brand: document.getElementById("brand").value,
					model: document.getElementById("model").value,
					fuel: document.getElementById("fuel").value,
					engine: document.getElementById("engine").value,
					info: document.getElementById("info").value,
					seats: document.getElementById("seats").value,
					price: document.getElementById("price").value,
					numOfCars: document.getElementById("numOfCars").value
				};
				
				const email = document.getElementById("email").value; // Get dealership email
				if (!email) {
					alert("Please enter the dealership's email!");
					return;
				}

				// Send the AJAX POST request
				$.ajax({
					url: `http://localhost:8080/home/dealerships/addCar?email=${encodeURIComponent(email)}`,
					method: "POST",
					contentType: "application/json",
					data: JSON.stringify(params),
					success: function () {
						alert("Car added successfully!"); // Alert for success
						showAll(); // Refresh the car list
					},
					error: function () {
						alert("Failed to add car. Please check your input or try again.");
					}
				});
			}
			function searchCars() {
				// Collect search parameters
				const params = {
					brand: document.getElementById("searchBrand").value,
					model: document.getElementById("searchModel").value,
					fuel: document.getElementById("searchFuel").value,
					engine: document.getElementById("searchEngine").value,
					seats: document.getElementById("searchSeats").value,
					price: document.getElementById("searchPrice").value
				};

				// Remove empty parameters
				Object.keys(params).forEach(key => {
					if (!params[key]) {
						delete params[key];
					}
				});

				// Send the AJAX GET request
				$.ajax({
					url: "http://localhost:8080/home/dealerships/cars/searchCar",
					method: "GET",
					data: params,
					success: function (response) {
						if (response.length === 0) {
							alert("No cars found for the given search criteria."); // Alert for no results
						} else {
							updateSearchResults(response); // Populate the search results table
						}
					},
					error: function () {
						alert("An error occurred while searching for cars. Please try again.");
					}
				});
			}
		
		</script>	
		
		<div class="container">
    <h1>All Cars</h1>
    <div class="section">
        <table id="resultsTable">
            <thead>
                <tr>
                    <th>Brand</th>
                    <th>Model</th>
                    <th>Fuel</th>
                    <th>Engine</th>
                    <th>Info</th>
                    <th>Seats</th>
                    <th>Price</th>
                    <th>Number of Cars</th>
                </tr>
            </thead>
            <tbody>
                <!-- Rows populated dynamically -->
            </tbody>
        </table>
    </div>

		<br><br>

		 <h1>Add a Car</h1>
    <div class="section">
        <form id="addCarForm">
            <label for="id">ID:</label>
            <input type="text" id="id" placeholder="Enter Car ID" />

            <label for="brand">Brand:</label>
            <input type="text" id="brand" placeholder="Enter Car Brand" />

            <label for="model">Model:</label>
            <input type="text" id="model" placeholder="Enter Car Model" />

            <label for="fuel">Fuel:</label>
            <input type="text" id="fuel" placeholder="Enter Fuel Type" />

            <label for="engine">Engine:</label>
            <input type="text" id="engine" placeholder="Enter Engine Type" />

            <label for="info">Info:</label>
            <input type="text" id="info" placeholder="Additional Info" />

            <label for="seats">Seats:</label>
            <input type="number" id="seats" placeholder="Number of Seats" />

            <label for="price">Price:</label>
            <input type="number" id="price" placeholder="Price" />

            <label for="numOfCars">Number of Cars:</label>
            <input type="number" id="numOfCars" placeholder="Number of Cars" />
			
			<label for="email">Dealership Email:</label>
			<input type="email" id="email" placeholder="Enter Dealership Email" required />

            <button type="button" onclick="addCar();">Add Car</button>
        </form>
    </div>
		
		<br><br>

		 <h1>Search for Cars</h1>
    <div class="section">
        <form id="searchForm">
            <label for="searchBrand">Brand:</label>
            <input type="text" id="searchBrand" placeholder="Enter Car Brand" />

            <label for="searchModel">Model:</label>
            <input type="text" id="searchModel" placeholder="Enter Car Model" />

            <label for="searchFuel">Fuel:</label>
            <input type="text" id="searchFuel" placeholder="Enter Fuel Type" />

            <label for="searchEngine">Engine:</label>
            <input type="text" id="searchEngine" placeholder="Enter Engine Type" />

            <label for="searchSeats">Seats:</label>
            <input type="number" id="searchSeats" placeholder="Number of Seats" />

            <label for="searchPrice">Price:</label>
            <input type="number" id="searchPrice" placeholder="Price" />

            <button type="button" onclick="searchCars();">Search</button>
        </form>
    </div>
	<h1>Search Results</h1>
    <div class="section">
        <table id="searchResultsTable">
            <thead>
                <tr>
                    <th>Brand</th>
                    <th>Model</th>
                    <th>Fuel</th>
                    <th>Engine</th>
                    <th>Info</th>
                    <th>Seats</th>
                    <th>Price</th>
                    <th>Number of Cars</th>
                </tr>
            </thead>
            <tbody>
                <!-- Rows for search results -->
            </tbody>
        </table>
    </div>
</div>
	</body>
</html>